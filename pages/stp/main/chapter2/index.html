<!DOCTYPE html>
<html lang="jp">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>STP取説【基本操作】② 「描画順序」の使い方</title>
    <link rel="stylesheet" href="../../../css/style.css">
    <link rel="stylesheet" href="../../css/style.css">
    <link rel="icon" href="../../icons/stp.png" sizes="256x256">
    <script src="../../template/header.js"></script>
    <script src="../template/sectiontitle.js"></script>
    <link rel="prev" href="../chapter1/index.html">
    <link rel="next" href="../chapter3/index.html">
</head>
<body>
    <main>
        <h1>②「描画順序」の使い方</h1>
        <p>　立ち絵アイテム、表情アイテムに用意されている、リストボックスのようなコントローラ「描画順序」は、
            パーツをリストで管理するパラメータである。
        </p>
        <p>　このパラメータを使うにあたって、基本的な流れはだいたい以下のことの繰り返しになる。</p>
        <ol>
            <li>「＋」をおして、ポップアップツリーからリストに追加。</li>
            <li>リストの下に出現するパラメータを調整。</li>
            <li>（任意）デフォルト設定を追加。</li>
        </ol>
        <ol class="table_of_contents">
            <li>
                <a href="#PartsList">リスト編集ボタンの使い方</a>
                <ol>
                    <li><a href="#PartsList-AddPart">「＋」（追加ボタン）</a></li>
                    <li><a href="#PartsList-RemovePart">「ー」（削除ボタン）</a></li>
                    <li><a href="#PartsList-UpPart">「↑」（入れ替えボタン（上））</a></li>
                    <li><a href="#PartsList-DownPart">「↓」（入れ替えボタン（下））</a></li>
                </ol>
            </li>
            <li>
                <a href="#PartBlock">パーツブロック</a>
                <ol>
                    <li><a href="#PartBlock-PartImage">パーツ画像</a></li>
                    <li><a href="#PartBlock-Appear">表示/非表示の切り替え</a></li>
                    <li><a href="#PartBlock-TagAndOther">タグ・バス・親・備考</a></li>
                </ol>
            </li>
            <li>
                <a href="#RightClick">リストを右クリック</a>
                <ol>
                    <li><a href="#RightClick-Cut">切り取り</a></li>
                    <li><a href="#RightClick-Copy">コピー</a></li>
                    <li><a href="#RightClick-Paste">貼り付け</a></li>
                    <li><a href="#RightClick-Duplicate">複製</a></li>
                    <li><a href="#RightClick-Remove">削除</a></li>
                </ol>
            </li>
            <li>
                <a href="#DefaultOptionButtons">「デフォルト設定」ボタン群</a>
                <ol>
                    <li><a href="#DefaultOptionButtons-Save">「保存」</a></li>
                    <li><a href="#DefaultOptionButtons-Remove">「削除」</a></li>
                    <li><a href="#DefaultOptionButtons-Reload">「リロード」</a></li>
                </ol>
            </li>
            <li>
                <a href="#EditingPartArea">パーツ編集エリア</a>
                <ol>
                    <li><a href="#BlockInformationsCategoly">「ブロック情報」カテゴリ</a></li>
                    <li><a href="#DrawCategoly">「描画」カテゴリ</a></li>
                    <li><a href="#CenterPointCategoly">「中心位置」カテゴリ</a></li>
                    <li><a href="#CenterPointCategoly">「サブ拡大率」カテゴリ</a></li>
                </ol>
            </li>
        </ol>
        <h2 id="PartsList">リスト編集ボタンの使い方</h2>
        <p>　ここでは、リストに並ぶ要素を「パーツブロック」と表現する。</p>
        <h3 id="PartsList-AddPart">「＋」（追加ボタン）</h3>
        <p>　このボタンを押すと左側に、キャラクター設定の「素材の場所」で指定したフォルダ内の画像ファイルの一覧が出てくる。</p>
        <p>　ボタンを押すとき、パーツブロックを選択していない場合は、リストの一番下に新しいパーツブロックが追加される。</p>
        <p>　逆に、既にいずれかの要素、仮にN番目のパーツブロックを選択している状態なら、ボタンが押されるとN番目に新しいパーツブロックが来るように、間に差し込まれる。</p>
        <h3 id="PartsList-RemovePart">「ー」（削除ボタン）</h3>
        <p>　選択されているパーツブロックを取り除いて、そこから下のパーツブロックが上に詰め寄せられる。</p>
        <p>　パーツブロックが選択されていない状態だとボタンが押せない。</p>
        <h3 id="PartsList-UpPart">「▲」（入れ替えボタン（上））</h3>
        <p>　選択されているブロックを一つ上のブロックと順序を入れ替える。</p>
        <p>　ブロックが選択されていない状態だとボタンが押せない。</p>
        <h3 id="PartsList-DownPart">「▼」（入れ替えボタン（下））</h3>
        <p>　選択されているブロックを一つ下のブロックと順序を入れ替える。</p>
        <p>　ブロックが選択されていない状態だとボタンが押せない。</p>
        <h2 id="PartBlock">パーツブロック</h2>
        <p>　「描画順序」にてリストアップされ、立ち絵の１パーツを表す。選択されると、リストの下に<a href="#EditingPartArea">「パーツ編集エリア」</a>が出現する。</p>
        <p>　描画時はリスト最上のパーツブロックから順に描画されるので、最下のパーツブロックが手前に描画される。これはタイムラインのレイヤーと似ている。</p>
        <p>　ここに含まれているUIたちはいずれも<a href="#EditingPartArea">「パーツ編集エリア」</a>における<a href="#BlockInformationsCategoly">「ブロック情報」カテゴリ</a>内のパラメータとリンクしている</p>
        <h3 id="PartBlock-PartImage">パーツ画像</h3>
        <p>　<a href="#EditingPartArea">「パーツ編集エリア」</a>の「画像」と値がリンクしており、
            このパーツブロックが立ち絵描画時に使う画像を表示している。
        </p>
        <p>　また、このUI自体がファイルセレクターとなっており、ここからでもファイルの選択・変更が可能である。</p>
        <h3 id="PartBlock-Appear">表示/非表示の切り替え</h3>
        <p>　チェックボックスになっており、デフォルトではチェックが入った状態である。チェックが入っているブロックは立ち絵描画時に描画されるが、チェックを外すと描画されなくなる。</p>
        <h3 id="PartBlock-TagAndOther">タグ・バス・親・備考</h3>
        <p>　<a href="#EditingPartArea">「パーツ編集エリア」</a>のパラメータ「タグ」「バス」「親」「備考」の値を表示している。</p>
        <h2 id="RightClick">リストを右クリック</h2>
        <p>　v1.0.5.0より、新機能として追加されました。パーツブロックが並ぶリストの、ブロック本体か余白を右クリックすると、５つの項目が並んだメニューが出てきます。以下のいずれの操作も、実際にクリップボードにデータが貼られているわけではなく、プラグイン内部で異なるリスト間で共有できるようにデータを記憶させているだけです。</p>
        <p>　「異なるリスト間で共有できる」ので、同じキャラクターの別アイテム同士はもちろん、違うキャラクターのアイテム同士でも、図形アイテム版と立ち絵版のアイテム同士でも、さらにはタイムライン上のアイテムからsin型カスタムパーツ立ち絵が設定されているキャラクターの立ち絵/表情アイテム設定に持ってくることも可能です。これでかなり使いやすくなったのではないでしょうか。</p>
        <h3 id="RightClick-Cut">切り取り</h3>
        <p>　パーツブロックが選択されている時に選択ができます。選択すると、リストにおいて選択されていたパーツブロックが取り除かれます。切り取ったパーツブロックは<a href="#RightClick-Paste">貼り付け</a>で貼り付けることができます。</p>
        <h3 id="RightClick-Copy">コピー</h3>
        <p>　パーツブロックが選択されている時に選択ができます。選択すると、リストにおいて選択されていたパーツブロックを<a href="#RightClick-Paste">貼り付け</a>で好きなところにコピペできます。</p>
        <h3 id="RightClick-Paste">貼り付け</h3>
        <p>　編集中にリスト内で「<a href="#RightClick-Cut">切り取り</a>」か「 <a href="#RightClick-Copy">コピー</a>」のどちらかを既に実行している場合、選択することができます。選択すると、リストにおいて選択されていたパーツブロックから下のものを一つ下にずらして空いたところに切り取り / コピーしたブロックが差し込まれます。パーツブロックを選択していない状態で実行すると、リストの最後にパーツブロックが貼り付けられます。</p>
        <h3 id="RightClick-Duplicate">複製</h3>
        <p>　パーツブロックが選択されている時に選択ができます。選択すると、リストにおいて選択されていたパーツブロックが、それより下のものを一つ下にずらして空いたところに選択されていたパーツブロックの複製物が差し込まれます。</p>
        <h3 id="RightClick-Remove">削除</h3>
        <p>　パーツブロックが選択されている時に選択ができます。選択すると、リストにおいて選択されていたパーツブロックが取り除かれます。</p>
        <h2 id="DefaultOptionButtons">「デフォルト設定」ボタン群</h2>
        <p>　ブロックが描画する画像ファイルそのものに、「パーツ編集エリア」内のパラメータのデフォルト設定を持たせることで、画像を指定したときにパラメータを簡単に調整したいと思い、実装した機能。</p>
        <p>　製作者なのにうまく説明できなくて申し訳ない。とりあえず、これだけは言わせてもらう。デフォルトを設定すると、素材をzipにまとめて配布した際に、素材利用者が短時間で準備を整えることが可能となる。</p>
        <h3 id="DefaultOptionButtons-Save">「保存」</h3>
        <p>　<a href="#EditingPartArea">「パーツ編集エリア」</a>内の全パラメータを、選択している画像ファイル固有のデフォルト設定として記録するボタン。</p>
        <p>　画像と同じ名前の「stpi」という拡張子のファイルに記録することで、同じ画像ファイルを指定した際に「リロード」ボタンを押すことで、全パラメータが自動でデフォルト値に書き換えられる。</p>
        <p>　また、パーツブロック追加時にその画像が選択された状態でブロックが作成されるとき、デフォルト値に設定された状態でブロックが生成される。</p>
        <p>※「stpi」ファイルには今後、デフォルト値以外の情報も記録されるようになる予定。デフォルト値記録用ファイルという認識だと、開発者が黙っちゃいない。</p>
        <p>※「全パラメータを記録する」という文面に見えるが、実はファイル内には画像ファイル本体のパスだけは抜き取ってある。
            素材に混ぜ込んで配布することを想定し、ユーザの個人情報を漏らさない仕様にした。 </p>
        <h3 id="DefaultOptionButtons-Remove">「削除」</h3>
        <p>　「stpi」ファイルから、画像ファイル固有のパラメータデフォルト値の設定を取り除くボタン。「stpi」ファイルが削除されるわけではない。あくまで内部データの一部が削除されるだけ。</p>
        <h3 id="DefaultOptionButtons-Reload">「リロード」</h3>
        <p>　選択している画像ファイルに対応する「stpi」ファイルが存在し、その内部にパラメータのデフォルト値が記録されてる状態で特殊処理をさせるボタン。</p>
        <p>　押すことでパーツの全パラメータが自動でデフォルト値に上書きされる。</p>
        <p>　注意してほしいのは、描画する画像を切り替えただけではパラメータが書き換えられるわけではないこと。</p>
        <p>　もし、別画像に切り替えた際にその画像のデフォルト値を呼び出したいときは、もう一度ボタンを押すこと。</p>
        <h2 id="EditingPartArea">パーツ編集エリア</h2>
        <p>　使用目的は異なれど、本プラグインを求めるユーザー全員が魅力を感じたであろう要素の紹介がようやくできるね。ヤッタネ!!</p>
        <p>　主に、パーツをどこに、どの角度で描画するか、などを調整するコントローラがこのエリアに含まれている。</p>
        <h3 id="BlockInformationsCategoly">「ブロック情報」カテゴリ</h3>
        <p>　パーツブロックに表示されるパラメータがまとめられている。</p>
        <ol class="normal_list">
            <li>「タグ」：パーツの名前</li>
            <li>「親」：名前の一致するタグを持つパーツに動きを連動させる。blenderでいう親ボーンを指定する。「手」の親に「腕」を指定する、といった使い方が挙げられる。</li>
            <li>「バス」：バス番号を指定する。詳しく言うと、同じバス同士では「描画順序」に並ぶブロックの順に従って描画されるが、異なるバス同士ではバス番号が高い方が後に描画される。タイムライン上でも実現できなかった「レイヤーを途中で入れ替える」などの特殊処理が可能。</li>
            <li>「画像」：パーツ描画時に、実際に描画する画像ファイル（差分レイヤー用の画像は選択できない）。実は立ち絵素材のディレクトリ外から参照することも可能です。</li>
            <li>「差分レイヤー」：代表画像とレイヤー画像を切り替える。詳細は&lt;|準備中...|&gt;</li>
        </ol>
        <h3 id="DrawCategoly">「描画」カテゴリ</h3>
        <p>　視覚アイテムの「描画」カテゴリにある一部のパラメータを真似した。</p>
        <ol class="normal_list">
            <li>「X」：パーツの描画位置のX座標</li>
            <li>「Y」：パーツの描画位置のY座標</li>
            <li>「不透明度」：パーツの不透明度</li>
            <li>「回転角」：パーツの回転角</li>
            <li>「左右反転」：０の時は変化がないが、１になると左右が反転する。本家はトグルで制御するが、このようにスライダーにすることで任意のタイミングで切り替えることを可能にした。</li>
            <li>「合成モード」：視覚アイテムの「描画」カテゴリにある「合成モード」の全種が選択可能。【おまけ】カスタム複製エフェクトでこれ作るとき、地味に疲れた（）</li>
            <li>「拡大率依存」「不透明度依存」「回転角依存」：拡大率、不透明度、回転角をそれぞれ親パーツに依存させるかを切り替える。ここは流石にトグルでいいでしょう。</li>
        </ol>
        <h3 id="CenterPointCategoly">「中心位置」カテゴリ</h3>
        <p>　映像エフェクトの「中心位置」を真似した。パーツによっては回転や拡大の中心位置が異なるので、用意しました。</p>
        <ol class="normal_list">
            <li>「X」：画像の回転と拡大の中心となる位置のX座標</li>
            <li>「Y」：画像の回転と拡大の中心となる位置のY座標</li>
            <li>「位置を保持」：実際の描画位置を固定したまま中心位置を調節するかを切り替える。</li>
        </ol>
        <h3 id="CenterPointCategoly">「サブ拡大率」カテゴリ</h3>
        <p>
            　映像エフェクトの「拡大縮小」を一部真似した。
            立ち絵によっては瞬きを縦の拡大率で表現することもあるので、用意しました。
        </p>
        <p>　注意してほしいのは、「拡大率依存」に影響していないことです。（つまり、親も子もサブ拡大率には影響しない。）</p>
        <br>
        <div class="next_and_prev">
            <div class="prev_page">
                <p>① <a href="../chapter1/index.html">準備</a></p>
            </div>
            <p class="next_and_prev_icon"></p>
            <div class="next_page">
                <p>③ <a href="../chapter3/index.html">タイムライン上にアイテムを置く</a></p>
            </div>
        </div>
        <br>
        <p>↩「<a href="../index.html">STP取説【本編】</a>」へ戻る</p>
        <p>↩「<a href="../../index.html">『sin型カスタムパーツ立ち絵』取扱説明書</a>」へ戻る</p>
        <p>↩「<a href="../../../index.html">Beta's Project</a>」へ戻る</p>
    </main>
</body>
</html>